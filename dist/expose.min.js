/*! expose.js - v0.1.0 - 2013-08-17
 * https://github.com/wnr/expose.js
 * Copyright (c) 2013 Lucas Wiener; Licensed MIT
 */


!function(a){"use strict";a.run=function(){}}(this.expose=this.expose||{}),function(a){"use strict";if(!a)throw new Error("Invalid expose given.");return a.log?(a.log("A log function is already defined. Discarding log module."),void 0):(a.log=function(){if(console&&console.log){for(var a,b=0;b<arguments.length;b++)a+=arguments[b],b+1===arguments.length&&(a+=" ");a&&console.log(a)}},void 0)}(this.expose=this.expose||{}),function(a,b){"use strict";if(!a)throw new Error("Invalid expose given.");if(a.ajax)return a.log("An ajax function is already. Discarding ajax module."),void 0;var c=function(){var a=!1;try{a=new b.XMLHttpRequest}catch(c){a=new b.ActiveXObject("Microsoft.XMLHTTP")}return function(){return a}}();a.ajax=function(a,b){var d=c();d&&(d.open("GET",a,!0),d.onreadystatechange=function(){4!==d.readyState||200!==d.status&&304!==d.status||b(d.responseText)},4!==d.readyState&&d.send(null))}}(this.expose=this.expose||{},this),function(a){"use strict";if(!a)throw new Error("Invalid expose given.");if(a.css)return a.log("A css object already exists. Discarding css module."),void 0;a.css={};var b=a.css;b.getInternal=function(a){if("function"!=typeof a)throw new Error("Callback required");for(var b="",c=document.getElementsByTagName("style"),d=0;d<c.length;d++){var e=c[d].firstChild.data;b+=e}a(b)},b.getExternal=function(b){function c(a){return a.href&&a.href.length>0}function d(){for(var a=[],b=0;b<document.styleSheets.length;b++){var d=document.styleSheets[b];c(d)&&a.push(d)}return a}function e(b,c){var d=b.cssRules||b.rule||null;if(!d)return a.ajax(b.href,function(d){if(d===!1)throw new Error("Failed to read rules of stylesheet");a.log("Read external stylesheet with ajax:",b.href),c(d)}),void 0;for(var e="",f=0;f<d.length;f++)e+=d[f].cssText;var g=Array.prototype.slice.call(arguments,2);g.unshift(e),a.log("Read external stylesheet with cssText:",b.href),c.apply(a,g)}if("function"!=typeof b)throw new Error("Callback required");for(var f="",g=d(),h=0,i=function(a){f+=a,h++,h===g.length&&b(f)},j=0;j<g.length;j++)e(g[j],i)}}(this.expose=this.expose||{}),function(a){if(!a)throw new Error("Invalid expose given.");a.parseCSS||(a.parseCSS=function(a,b){function c(a){var b=a.match(/\n/g);b&&(D+=b.length);var c=a.lastIndexOf("\n");E=~c?a.length-c:E+a.length}function d(){var a={line:D,column:E};return b.position?function(b){return b.position={start:a,end:{line:D,column:E}},l(),b}:e}function e(a){return l(),a}function f(b){var c=new Error(b+" near line "+D+":"+E);throw c.line=D,c.column=E,c.source=a,c}function g(){return{type:"stylesheet",stylesheet:{rules:j()}}}function h(){return k(/^{\s*/)}function i(){return k(/^}/)}function j(){var b,c=[];for(l(),m(c);"}"!=a[0]&&(b=B()||C());)c.push(b),m(c);return c}function k(b){var d=b.exec(a);if(d){var e=d[0];return c(e),a=a.slice(e.length),d}}function l(){k(/^\s*/)}function m(a){var b;for(a=a||[];b=n();)a.push(b);return a}function n(){var b=d();if("/"==a[0]&&"*"==a[1]){for(var e=2;null!=a[e]&&("*"!=a[e]||"/"!=a[e+1]);)++e;e+=2;var f=a.slice(2,e-2);return E+=2,c(f),a=a.slice(e),E+=2,b({type:"comment",comment:f})}}function o(){var a=k(/^([^{]+)/);if(a)return a[0].trim().split(/\s*,\s*/)}function p(){var a=d(),b=k(/^(\*?[-\/\*\w]+)\s*/);if(b){if(b=b[0],!k(/^:\s*/))return f("property missing ':'");var c=k(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/);if(!c)return f("property missing value");var e=a({type:"declaration",property:b,value:c[0].trim()});return k(/^[;\s]*/),e}}function q(){var a=[];if(!h())return f("missing '{'");m(a);for(var b;b=p();)a.push(b),m(a);return i()?a:f("missing '}'")}function r(){for(var a,b=[],c=d();a=k(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/);)b.push(a[1]),k(/^,\s*/);return b.length?c({type:"keyframe",values:b,declarations:q()}):void 0}function s(){var a=d(),b=k(/^@([-\w]+)?keyframes */);if(b){var c=b[1],b=k(/^([-\w]+)\s*/);if(!b)return f("@keyframes missing name");var e=b[1];if(!h())return f("@keyframes missing '{'");for(var g,j=m();g=r();)j.push(g),j=j.concat(m());return i()?a({type:"keyframes",name:e,vendor:c,keyframes:j}):f("@keyframes missing '}'")}}function t(){var a=d(),b=k(/^@supports *([^{]+)/);if(b){var c=b[1].trim();if(!h())return f("@supports missing '{'");var e=m().concat(j());return i()?a({type:"supports",supports:c,rules:e}):f("@supports missing '}'")}}function u(){var a=d(),b=k(/^@media *([^{]+)/);if(b){var c=b[1].trim();if(!h())return f("@media missing '{'");var e=m().concat(j());return i()?a({type:"media",media:c,rules:e}):f("@media missing '}'")}}function v(){var a=d(),b=k(/^@page */);if(b){var c=o()||[];if(!h())return f("@page missing '{'");for(var e,g=m();e=p();)g.push(e),g=g.concat(m());return i()?a({type:"page",selectors:c,declarations:g}):f("@page missing '}'")}}function w(){var a=d(),b=k(/^@([-\w]+)?document *([^{]+)/);if(b){var c=(b[1]||"").trim(),e=b[2].trim();if(!h())return f("@document missing '{'");var g=m().concat(j());return i()?a({type:"document",document:e,vendor:c,rules:g}):f("@document missing '}'")}}function x(){return A("import")}function y(){return A("charset")}function z(){return A("namespace")}function A(a){var b=d(),c=k(new RegExp("^@"+a+" *([^;\\n]+);"));if(c){var e={type:a};return e[a]=c[1].trim(),b(e)}}function B(){return s()||u()||t()||x()||y()||z()||w()||v()}function C(){var a=d(),b=o();return b?(m(),a({type:"rule",selectors:b,declarations:q()})):void 0}b=b||{};var D=1,E=1;return g()})}(this.expose=this.expose||{});