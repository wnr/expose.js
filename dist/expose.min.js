/*! expose.js - v0.1.0 - 2013-08-16
 * https://github.com/wnr/expose.js
 * Copyright (c) 2013 Lucas Wiener; Licensed MIT
 */


!function(a){"use strict";a.expose={};var b=a.expose;b.css={},b.css.getInternal=function(a){if("function"!=typeof a)throw new Error("Callback required");for(var b="",c=document.getElementsByTagName("style"),d=0;d<c.length;d++){var e=c[d].firstChild.data;b+=e}a(b)},b.css.getExternal=function(c){function d(a){return a.href&&a.href.length>0}function e(){for(var a=[],b=0;b<document.styleSheets.length;b++){var c=document.styleSheets[b];d(c)&&a.push(c)}return a}function f(c,d){var e=c.cssRules||c.rule||null;if(!e)return b.ajax(c.href,function(a){if(a===!1)throw new Error("Failed to read rules of stylesheet");b.log("Read external stylesheet with ajax:",c.href),d(a)}),void 0;for(var f="",g=0;g<e.length;g++)f+=e[g].cssText;var h=Array.prototype.slice.call(arguments,2);h.unshift(f),b.log("Read external stylesheet with cssText:",c.href),d.apply(a.expose,h)}if("function"!=typeof c)throw new Error("Callback required");for(var g="",h=e(),i=0,j=function(a){g+=a,i++,i===h.length&&c(g)},k=0;k<h.length;k++)f(h[k],j)},b.utils={},b.run=function(){}}(this),function(a){"use strict";if(!a.expose)throw new Error("log function requires an expose object to be defined in context.");if(a.expose.log)throw new Error("A log function is already defined in expose object.");a.expose.log=function(){if(console&&console.log){for(var a,b=0;b<arguments.length;b++)a+=arguments[b],b+1===arguments.length&&(a+=" ");a&&console.log(a)}}}(this),function(a){"use strict";if(!a.expose)throw new Error("ajax function requires an expose object to be defined in context.");if(a.expose.ajax)throw new Error("An ajax function is already defined in expose object.");var b=function(){var b=!1;try{b=new a.XMLHttpRequest}catch(c){b=new a.ActiveXObject("Microsoft.XMLHTTP")}return function(){return b}}();a.expose.ajax=function(a,c){var d=b();d&&(d.open("GET",a,!0),d.onreadystatechange=function(){4!==d.readyState||200!==d.status&&304!==d.status||c(d.responseText)},4!==d.readyState&&d.send(null))}}(this),function(a){if(!a.expose)throw new Error("CSS parser requires an expose object to be defined in context.");if(a.expose.parseCSS)throw new Error("A CSS parser is already defined in expose object.");a.expose.parseCSS=function(a,b){function c(a){var b=a.match(/\n/g);b&&(D+=b.length);var c=a.lastIndexOf("\n");E=~c?a.length-c:E+a.length}function d(){var a={line:D,column:E};return b.position?function(b){return b.position={start:a,end:{line:D,column:E}},l(),b}:e}function e(a){return l(),a}function f(b){var c=new Error(b+" near line "+D+":"+E);throw c.line=D,c.column=E,c.source=a,c}function g(){return{type:"stylesheet",stylesheet:{rules:j()}}}function h(){return k(/^{\s*/)}function i(){return k(/^}/)}function j(){var b,c=[];for(l(),m(c);"}"!=a[0]&&(b=B()||C());)c.push(b),m(c);return c}function k(b){var d=b.exec(a);if(d){var e=d[0];return c(e),a=a.slice(e.length),d}}function l(){k(/^\s*/)}function m(a){var b;for(a=a||[];b=n();)a.push(b);return a}function n(){var b=d();if("/"==a[0]&&"*"==a[1]){for(var e=2;null!=a[e]&&("*"!=a[e]||"/"!=a[e+1]);)++e;e+=2;var f=a.slice(2,e-2);return E+=2,c(f),a=a.slice(e),E+=2,b({type:"comment",comment:f})}}function o(){var a=k(/^([^{]+)/);if(a)return a[0].trim().split(/\s*,\s*/)}function p(){var a=d(),b=k(/^(\*?[-\/\*\w]+)\s*/);if(b){if(b=b[0],!k(/^:\s*/))return f("property missing ':'");var c=k(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/);if(!c)return f("property missing value");var e=a({type:"declaration",property:b,value:c[0].trim()});return k(/^[;\s]*/),e}}function q(){var a=[];if(!h())return f("missing '{'");m(a);for(var b;b=p();)a.push(b),m(a);return i()?a:f("missing '}'")}function r(){for(var a,b=[],c=d();a=k(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/);)b.push(a[1]),k(/^,\s*/);return b.length?c({type:"keyframe",values:b,declarations:q()}):void 0}function s(){var a=d(),b=k(/^@([-\w]+)?keyframes */);if(b){var c=b[1],b=k(/^([-\w]+)\s*/);if(!b)return f("@keyframes missing name");var e=b[1];if(!h())return f("@keyframes missing '{'");for(var g,j=m();g=r();)j.push(g),j=j.concat(m());return i()?a({type:"keyframes",name:e,vendor:c,keyframes:j}):f("@keyframes missing '}'")}}function t(){var a=d(),b=k(/^@supports *([^{]+)/);if(b){var c=b[1].trim();if(!h())return f("@supports missing '{'");var e=m().concat(j());return i()?a({type:"supports",supports:c,rules:e}):f("@supports missing '}'")}}function u(){var a=d(),b=k(/^@media *([^{]+)/);if(b){var c=b[1].trim();if(!h())return f("@media missing '{'");var e=m().concat(j());return i()?a({type:"media",media:c,rules:e}):f("@media missing '}'")}}function v(){var a=d(),b=k(/^@page */);if(b){var c=o()||[];if(!h())return f("@page missing '{'");for(var e,g=m();e=p();)g.push(e),g=g.concat(m());return i()?a({type:"page",selectors:c,declarations:g}):f("@page missing '}'")}}function w(){var a=d(),b=k(/^@([-\w]+)?document *([^{]+)/);if(b){var c=(b[1]||"").trim(),e=b[2].trim();if(!h())return f("@document missing '{'");var g=m().concat(j());return i()?a({type:"document",document:e,vendor:c,rules:g}):f("@document missing '}'")}}function x(){return A("import")}function y(){return A("charset")}function z(){return A("namespace")}function A(a){var b=d(),c=k(new RegExp("^@"+a+" *([^;\\n]+);"));if(c){var e={type:a};return e[a]=c[1].trim(),b(e)}}function B(){return s()||u()||t()||x()||y()||z()||w()||v()}function C(){var a=d(),b=o();return b?(m(),a({type:"rule",selectors:b,declarations:q()})):void 0}b=b||{};var D=1,E=1;return g()}}(this);